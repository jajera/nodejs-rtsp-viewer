# ============================================
# Camera Web Viewer - Configuration File
# ============================================
# Copy this file to .env and configure your cameras
# cp .env.example .env

# ============================================
# Server Configuration
# ============================================
PORT=3000
HLS_OUTPUT_DIR=./hls
LOG_LEVEL=info

# ============================================
# Global Video/Audio Mode Defaults
# ============================================
# These defaults apply to all cameras unless overridden per camera
DEFAULT_VIDEO_MODE=reencode
# Options: 'reencode' (decode and re-encode) or 'passthrough' (copy stream)

DEFAULT_AUDIO_MODE=auto
# Options: 'disabled' (no audio), 'auto' (auto-detect), 'manual' (use audioStreamIndex)

DEFAULT_AUDIO_STREAM_INDEX=0
# Audio stream index for 'manual' audio mode (0 = first stream, 1 = second, etc.)

DEFAULT_AUDIO_ENCODING_MODE=auto
# Options: 'auto' (let FFmpeg handle conversion) or 'force' (force specific settings)

# ============================================
# Global FFmpeg Settings
# ============================================
VIDEO_BITRATE=2048k
# Video bitrate for re-encoding (e.g., "2000k", "2048k", "4000k")

DEFAULT_ERROR_DETECTION=aggressive
# Error detection mode for corrupted streams
# Options: 'ignore_err', 'aggressive', 'careful', 'compliant'

# ============================================
# Camera Configuration
# ============================================
# Configure your cameras in the CAMERAS array below
# Each camera can override global defaults

CAMERAS=[
  {
    "id": "camera1",
    "name": "Camera 1",
    "rtspUrl": "rtsp://username:password@192.168.1.100:554/stream1",
    "rtspTransport": "tcp",
    "videoMode": "reencode",
    "audioMode": "auto"
  },
  {
    "id": "camera2",
    "name": "Camera 2",
    "rtspUrl": "rtsp://username:password@192.168.1.101:554/stream1",
    "rtspTransport": "tcp",
    "videoMode": "reencode",
    "audioMode": "disabled",
    "videoDecoder": "h264",
    "errorDetection": "aggressive",
    "hlsListSize": 10
  }
]

# ============================================
# Camera Configuration Options
# ============================================
# Each camera object supports the following fields:
#
# Required:
#   - id: Unique identifier for the camera (e.g., "camera1", "nvr_ch1")
#   - name: Display name for the camera (e.g., "Front Door", "NVR Channel 1")
#   - rtspUrl: RTSP stream URL (e.g., "rtsp://user:pass@ip:port/path")
#
# Optional (overrides global defaults):
#   - rtspTransport: "tcp" or "udp" (default: "tcp")
#   - videoMode: "reencode" or "passthrough" (default: from DEFAULT_VIDEO_MODE)
#   - audioMode: "disabled", "auto", or "manual" (default: from DEFAULT_AUDIO_MODE)
#   - audioStreamIndex: Audio stream index for "manual" mode (default: from DEFAULT_AUDIO_STREAM_INDEX)
#   - audioEncodingMode: "auto" or "force" (default: from DEFAULT_AUDIO_ENCODING_MODE)
#   - videoDecoder: Explicit decoder to use (e.g., "h264", "hevc") - auto-detects if not set
#   - errorDetection: "ignore_err", "aggressive", "careful", or "compliant" (default: from DEFAULT_ERROR_DETECTION)
#   - hlsListSize: Number of HLS segments to keep (default: 10)
#   - vsyncMode: "cfr" (constant frame rate) or "vfr" (variable frame rate) (default: "cfr")
#
# ============================================
# Example Configurations
# ============================================

# Example 1: Simple RTSP Camera (Tapo, Amcrest, etc.)
# {
#   "id": "tapo_cam1",
#   "name": "Front Door",
#   "rtspUrl": "rtsp://admin:password@192.168.1.100:554/stream1",
#   "rtspTransport": "tcp",
#   "videoMode": "reencode",
#   "audioMode": "auto"
# }

# Example 2: Hikvision NVR Channel
# {
#   "id": "hikvision_nvr_ch1",
#   "name": "NVR Channel 1",
#   "rtspUrl": "rtsp://admin:password@192.168.1.100:554/Streaming/Channels/102",
#   "rtspTransport": "tcp",
#   "videoMode": "reencode",
#   "audioMode": "disabled",
#   "videoDecoder": "h264",
#   "errorDetection": "aggressive"
# }

# Example 3: Hikvision NVR with H.265 Main Stream
# {
#   "id": "hikvision_nvr_ch1_main",
#   "name": "NVR Channel 1 (Main)",
#   "rtspUrl": "rtsp://admin:password@192.168.1.100:554/Streaming/Channels/101",
#   "rtspTransport": "tcp",
#   "videoMode": "reencode",
#   "audioMode": "disabled",
#   "videoDecoder": "hevc",
#   "errorDetection": "aggressive"
# }

# Example 4: Camera with Custom HLS Settings
# {
#   "id": "camera_custom",
#   "name": "Custom Camera",
#   "rtspUrl": "rtsp://user:pass@192.168.1.100:554/stream1",
#   "rtspTransport": "tcp",
#   "videoMode": "reencode",
#   "audioMode": "auto",
#   "hlsListSize": 20,
#   "vsyncMode": "cfr"
# }

# Example 5: Camera with Manual Audio Stream Selection
# {
#   "id": "camera_audio",
#   "name": "Camera with Audio",
#   "rtspUrl": "rtsp://user:pass@192.168.1.100:554/stream1",
#   "rtspTransport": "tcp",
#   "videoMode": "reencode",
#   "audioMode": "manual",
#   "audioStreamIndex": 0,
#   "audioEncodingMode": "auto"
# }

# ============================================
# RTSP URL Formats
# ============================================
# 
# Tapo Camera:
#   rtsp://username:password@camera_ip:554/stream1
#   rtsp://username:password@camera_ip:554/stream2
#
# Amcrest Camera:
#   rtsp://username:password@camera_ip:554/cam/realmonitor?channel=1&subtype=0
#   rtsp://username:password@camera_ip:554/Streaming/Channels/101
#
# Hikvision NVR:
#   Main stream: rtsp://username:password@nvr_ip:554/Streaming/Channels/101
#   Sub stream:  rtsp://username:password@nvr_ip:554/Streaming/Channels/102
#   Alternative: rtsp://username:password@nvr_ip:554/h264/ch1/main/av_stream
#   Alternative: rtsp://username:password@nvr_ip:554/h264/ch1/sub/av_stream
#
# Channel numbering:
#   Channel 1: 101 (main) or 102 (sub)
#   Channel 2: 201 (main) or 202 (sub)
#   Channel 3: 301 (main) or 302 (sub)
#   etc.
#
# ============================================
# Notes
# ============================================
# - Use TCP transport for better reliability, especially with Hikvision NVRs
# - Use UDP transport if TCP causes issues
# - Set videoDecoder explicitly if auto-detection fails (e.g., "h264", "hevc")
# - Use "errorDetection": "aggressive" for corrupted streams
# - Disable audio if camera produces noise or has no audio (audioMode: "disabled")
# - Increase hlsListSize for more buffering (default: 10, max recommended: 20)
